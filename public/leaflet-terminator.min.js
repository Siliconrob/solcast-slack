Date.prototype.getJulian=function(){return this/864e5+2440587.5},Date.prototype.getGMST=function(){var t=this.getJulian(),i=t-2451545;return(18.697374558+24.06570982441908*i)%24},L.Terminator=L.Polygon.extend({options:{color:"#00",opacity:.5,fillColor:"#00",fillOpacity:.5,resolution:2},initialize:function(t){this.version="0.1.0",this._R2D=180/Math.PI,this._D2R=Math.PI/180,L.Util.setOptions(this,t);var i=this._compute(this.options.time||null);this.setLatLngs(i)},setTime:function(t){this.options.time=t;var i=this._compute(t||null);this.setLatLngs(i)},_sunEclipticPosition:function(t){var i=t-2451545,n=280.46+.9856474*i;n%=360;var a=357.528+.9856003*i;a%=360;var o=n+1.915*Math.sin(a*this._D2R)+.02*Math.sin(2*a*this._D2R),s=1.00014-.01671*Math.cos(a*this._D2R)-.0014*Math.cos(2*a*this._D2R);return{lambda:o,R:s}},_eclipticObliquity:function(t){var i=t-2451545,n=i/36525,a=23.43929111-n*(46.836769/3600-n*(1831e-7/3600+n*(5.565e-7-n*(1.6e-10-4.34e-8*n/3600))));return a},_sunEquatorialPosition:function(t,i){var n=Math.atan(Math.cos(i*this._D2R)*Math.tan(t*this._D2R))*this._R2D,a=Math.asin(Math.sin(i*this._D2R)*Math.sin(t*this._D2R))*this._R2D,o=90*Math.floor(t/90),s=90*Math.floor(n/90);return n+=o-s,{alpha:n,delta:a}},_hourAngle:function(t,i,n){var a=n+t/15;return 15*a-i.alpha},_latitude:function(t,i){var n=Math.atan(-Math.cos(t*this._D2R)/Math.tan(i.delta*this._D2R))*this._R2D;return n},_compute:function(t){if(null==t)var i=new Date;else var i=new Date(t);for(var n,a,o=i.getJulian(),s=i.getGMST(),e=[],h=this._sunEclipticPosition(o),r=this._eclipticObliquity(o),l=this._sunEquatorialPosition(h.lambda,r),u=0;u<=720*this.options.resolution;u++)lng=-360+u/this.options.resolution,n=this._hourAngle(lng,l,s),a=this._latitude(n,l),e[u+1]=[a,lng];return l.delta<0?(e[0]=[90,-360],e[e.length]=[90,360]):(e[0]=[-90,-360],e[e.length]=[-90,360]),e}}),L.terminator=function(t){return new L.Terminator(t)};